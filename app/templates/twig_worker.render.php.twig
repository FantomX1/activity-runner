{#
Writes PHP code that's used to render twig templates for the TwigWorker
#}
<?php

use KnpU\ActivityRunner\Worker\Executor\TwigExecutor;

require '{{ projectPath }}/vendor/autoload.php';

$loader = new \Twig_Loader_Filesystem(array(
    // render things right in this same directory
    __DIR__
));
$environment = new \Twig_Environment($loader, array(
    'cache'            => false,
    'debug'            => true,
    'strict_variables' => true,
));

$environment->addExtension(new \Twig_Extension_Debug());

{#
    print any "context" PHP code that sets things up

    We force you to assume an $environment variable and to
    return the context array.
#}
function getTwigContext(\Twig_Environment $environment)
{
    {# this should return its code #}
    {{ context|raw }}
}

$context = getTwigContext($environment);
$entryPointFilename = '{{ entryPointFilename }}';

$twigExecutor = new TwigExecutor($environment);
$result = $twigExecutor->executeTwig($entryPointFilename, $context);

// serialize the result and return it
echo serialize($result);
